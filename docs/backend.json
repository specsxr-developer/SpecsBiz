{
  "entities": {
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a product in the inventory.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Product entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the product."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the product."
        },
        "sku": {
          "type": "string",
          "description": "Stock Keeping Unit, a unique identifier for the product."
        },
        "barcode": {
          "type": "string",
          "description": "Barcode of the product for easy scanning."
        },
        "price": {
          "type": "number",
          "description": "Price of the product."
        },
        "stockQuantity": {
          "type": "number",
          "description": "Current stock quantity of the product."
        },
        "alertThreshold": {
          "type": "number",
          "description": "Minimum stock quantity before an alert is triggered."
        }
      },
      "required": [
        "id",
        "name",
        "price",
        "stockQuantity"
      ]
    },
    "Sale": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Sale",
      "type": "object",
      "description": "Represents a sale transaction.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Sale entity."
        },
        "customerId": {
          "type": "string",
          "description": "Reference to Customer. (Relationship: Customer 1:N Sale)"
        },
        "saleDate": {
          "type": "string",
          "description": "Date and time of the sale.",
          "format": "date-time"
        },
        "totalAmount": {
          "type": "number",
          "description": "Total amount of the sale."
        },
        "productIds": {
          "type": "array",
          "description": "References to Products. (Relationship: Sale 1:N Product)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "customerId",
        "saleDate",
        "totalAmount"
      ]
    },
    "Customer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Customer",
      "type": "object",
      "description": "Represents a customer.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Customer entity."
        },
        "firstName": {
          "type": "string",
          "description": "First name of the customer."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the customer."
        },
        "email": {
          "type": "string",
          "description": "Email address of the customer.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "Phone number of the customer."
        },
        "address": {
          "type": "string",
          "description": "Address of the customer."
        },
        "segment": {
          "type": "string",
          "description": "Customer segment for categorization."
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email"
      ]
    },
    "Report": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Report",
      "type": "object",
      "description": "Represents a business report.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Report entity."
        },
        "reportDate": {
          "type": "string",
          "description": "Date the report was generated.",
          "format": "date-time"
        },
        "type": {
          "type": "string",
          "description": "Type of report (e.g., sales, revenue)."
        },
        "data": {
          "type": "string",
          "description": "Report data in JSON format."
        }
      },
      "required": [
        "id",
        "reportDate",
        "type",
        "data"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "username": {
          "type": "string",
          "description": "Username of the user."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "Role of the user (e.g., admin, staff)."
        },
        "isSecret": {
          "type": "boolean",
          "description": "Boolean value to determine if user is the secret account."
        }
      },
      "required": [
        "id",
        "username",
        "email",
        "role"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Represents a user of the application. Serves as the root document for all user-specific data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user.  It will be 'xrratul4763@gmail.com' for the special secret account."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Stores product information for a specific user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "productId",
              "description": "The unique identifier for the product."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/sales/{saleId}",
        "definition": {
          "entityName": "Sale",
          "schema": {
            "$ref": "#/backend/entities/Sale"
          },
          "description": "Stores sales transaction data for a specific user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "saleId",
              "description": "The unique identifier for the sale."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/customers/{customerId}",
        "definition": {
          "entityName": "Customer",
          "schema": {
            "$ref": "#/backend/entities/Customer"
          },
          "description": "Stores customer information for a specific user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "customerId",
              "description": "The unique identifier for the customer."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/reports/{reportId}",
        "definition": {
          "entityName": "Report",
          "schema": {
            "$ref": "#/backend/entities/Report"
          },
          "description": "Stores business report data for a specific user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "reportId",
              "description": "The unique identifier for the report."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support SpecsBiz's requirements for online/offline sync, user-specific data access, and a special secret account. To ensure Authorization Independence and facilitate robust security rules, we denormalize user roles and access rights where necessary. Specifically, the solution saves all data under a single user document to allow offline access and syncing when online for a small number of users. A designated secret user has read and write access to the data. Non-logged-in users will store data locally on their device and cannot use online features.\n\n*   **/users/{userId}/**: Contains all user-specific data (Products, Sales, Customers, Reports) to simplify data access and syncing for online users. It improves query performance and streamlines security rules.\n*   **Authorization Independence:** All data is stored under the logged-in user document. This eliminates the need for complex `get()` calls in security rules, simplifying authorization and enabling atomic operations.\n*   **QAPs:** Segregation is used, as all the data is stored inside the user's document. This allows straightforward rules to be written for data access."
  }
}